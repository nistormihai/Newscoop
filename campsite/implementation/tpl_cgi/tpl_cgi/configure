#!/bin/sh

[ "$CAMPSITE_PACKAGE_DIR" = "" ] && cd ../../.. && . ./configure --define_start_env && cd implementation/tpl_cgi/tpl_cgi
. ${INSTALL_CONF}/conf_functions

install_conf --set
[ $? -ne 0 ] && echo "Error reading install configuration" && exit 1

export CONF_DIR=/etc/${APP_NAME}

PACKAGE_TYPE=`cat $CAMPSITE_PACKAGE_DIR/.package_type`
[ "$PACKAGE_TYPE" = "binary" ] && exit 0

modules_conf --set ADMIN_INTERFACE
[ $? -ne 0 ] && echo "Error reading ADMIN_INTERFACE module configuration" && exit 1

cat > srv_def.h << EOF
/******************************************************************************

Defines used to connect to parser server

WARNING!!! This file is generated. Do not edit!

******************************************************************************/

#ifndef _SRV_DEF_H
#define _SRV_DEF_H

#define PARSER_IP "$ADMIN_INTERFACE_PARSER_IP"
#define PARSER_PORT $ADMIN_INTERFACE_PARSER_PORT

#endif
EOF
chmod o-rwx srv_def.h
